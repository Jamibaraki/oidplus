<div id="DBPLUGIN_PARAMS_ODBC">
	<p>ODBC DSN (<a href="https://www.connectionstrings.com/" target="_blank">examples</a>):<br><input id="odbc_dsn" type="text" value="DRIVER={SQL Server};SERVER=localhost;DATABASE=oidplus;CHARSET=UTF8" onkeypress="rebuild()" onkeyup="rebuild()" style="width:600px">  <span id="odbc_dsn_warn"></span>
	<br><font size="-1">Example for SQL Server: <i>DRIVER={SQL Server};SERVER=localhost;DATABASE=oidplus;CHARSET=UTF8</i></font></p>
	<p>ODBC Username:<br><input id="odbc_username" type="text" value="root" onkeypress="rebuild()" onkeyup="rebuild()">  <span id="odbc_username_warn"></span></p>
	<p>ODBC Password:<br><input id="odbc_password" type="password" value="" onkeypress="rebuild()" onkeyup="rebuild()">  <span id="odbc_password_warn"></span></p>
	<p>Which DBMS is used?<br>
	<i>Attention: OIDplus currently only implements the SQL dialect of MySQL/MariaDB and PostgreSQL and Microsoft SQL Server. Other DBMS will most likely not work.</i><br>
	<select name="odbc_slang" id="odbc_slang" onChange="dbplugin_changed()">
		<option value="mysql">MySQL / MariaDB</option>
		<option value="pgsql">PostgreSQL</option>
		<option value="mssql">Microsoft SQL Server</option>
	</select></p>
</div>
<script>
plugin_combobox_change_callbacks.push(function(strPlugin) {
	document.getElementById('DBPLUGIN_PARAMS_ODBC').style.display = (strPlugin == 'ODBC') ? "Block" : "None";
});
rebuild_callbacks.push(function() {
	var e = document.getElementById("db_plugin");
	var strPlugin = e.options[e.selectedIndex].value;
	if (strPlugin != 'ODBC') return true;

	document.getElementById('struct_cli_1').innerHTML = '';
	document.getElementById('struct_cli_2').innerHTML = '';
	document.getElementById('struct_1').href = 'struct_empty.sql.php';
	document.getElementById('struct_2').href = 'struct_with_examples.sql.php';

	error = false;

	// Check 1: dsn must not be empty
	if (document.getElementById('odbc_dsn').value.length == 0)
	{
		document.getElementById('odbc_dsn_warn').innerHTML = '<font color="red">Please specify a DSN!</font>';
		document.getElementById('config').innerHTML = '<b>&lt?php</b><br><br><i>// ERROR: Please specify a DSN!</i>';
		error = true;
	} else {
		document.getElementById('odbc_dsn_warn').innerHTML = '';
	}

	// Check 2: Username must not be empty
	if (document.getElementById('odbc_username').value.length == 0)
	{
		document.getElementById('odbc_username_warn').innerHTML = '<font color="red">Please specify a username!</font>';
		document.getElementById('config').innerHTML = '<b>&lt?php</b><br><br><i>// ERROR: Please specify a username!</i>';
		error = true;
	} else {
		document.getElementById('odbc_username_warn').innerHTML = '';
	}

	document.getElementById('struct_1').href = setupdir+'struct_empty.sql.php?plugin=odbc&prefix='+encodeURI(document.getElementById('tablename_prefix').value)+'&slang='+encodeURI(document.getElementById('odbc_slang').value);
	document.getElementById('struct_2').href = setupdir+'struct_with_examples.sql.php?plugin=odbc&prefix='+encodeURI(document.getElementById('tablename_prefix').value)+'&slang='+encodeURI(document.getElementById('odbc_slang').value);
	if (document.getElementById('odbc_slang').value == 'mysql') {
		document.getElementById('struct_cli_1').innerHTML = '<br>or via command line:<br><code>curl -s "'+document.getElementById('struct_1').href+'" | mysql -u '+document.getElementById('odbc_username').value+' -p</code>';
		document.getElementById('struct_cli_2').innerHTML = '<br>or via command line:<br><code>curl -s "'+document.getElementById('struct_2').href+'" | mysql -u '+document.getElementById('odbc_username').value+' -p</code>';
	} else if (document.getElementById('odbc_slang').value == 'pgsql') {
		document.getElementById('struct_cli_1').innerHTML = '<br>or via command line:<br><code>curl -s "'+document.getElementById('struct_1').href+'" | psql -h <font color="red">localhost</font> -U '+document.getElementById('odbc_username').value+' -d <font color="red">oidplus</font> -a</code>';
		document.getElementById('struct_cli_2').innerHTML = '<br>or via command line:<br><code>curl -s "'+document.getElementById('struct_2').href+'" | psql -h <font color="red">localhost</font> -U '+document.getElementById('odbc_username').value+' -d <font color="red">oidplus</font> -a</code>';
	} else {
		document.getElementById('struct_cli_1').innerHTML = '';
		document.getElementById('struct_cli_2').innerHTML = '';
	}

	return !error;
});
rebuild_config_callbacks.push(function() {
	var e = document.getElementById("db_plugin");
	var strPlugin = e.options[e.selectedIndex].value;
	if (strPlugin != 'ODBC') return '';

	return '<b>define</b>(\'OIDPLUS_ODBC_DSN\',         \''+document.getElementById('odbc_dsn').value+'\');<br>' +
	       '<b>define</b>(\'OIDPLUS_ODBC_USERNAME\',    \''+document.getElementById('odbc_username').value+'\');<br>' +
	       '<b>define</b>(\'OIDPLUS_ODBC_PASSWORD\',    \''+b64EncodeUnicode(document.getElementById('odbc_password').value)+'\'); // base64 encoded<br>';
});
</script>
