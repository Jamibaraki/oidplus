<div id="DBPLUGIN_PARAMS_PDO">
	<p><i>Attention: OIDplus currently only implements the SQL dialect of MySQL/MariaDB and PostgreSQL. Other DBMS will most likely not work.</i></p>
	<p>PDO DSN (<a href="https://www.php.net/manual/de/pdo.drivers.php" target="_blank">more information</a>):<br><input id="pdo_dsn" type="text" value="mysql:dbname=oidplus;host=localhost" onkeypress="rebuild()" onkeyup="rebuild()" style="width:600px">  <span id="pdo_dsn_warn"></span>
	<br><font size="-1">Example for MySQL/MariaDB: <i>mysql:dbname=oidplus;host=localhost;port=3306</i>
	<br>Example for PostgreSQL:    <i>pgsql:dbname=oidplus;host=localhost;port=5432</i></font></p>

	<p>PDO Username:<br><input id="pdo_username" type="text" value="root" onkeypress="rebuild()" onkeyup="rebuild()">  <span id="pdo_username_warn"></span></p>
	<p>PDO Password:<br><input id="pdo_password" type="password" value="" onkeypress="rebuild()" onkeyup="rebuild()">  <span id="pdo_password_warn"></span></p>
	<p>Which DBMS (SQL dialect) is used?<br>
	<i>Attention: If your DBMS is not listed, OIDplus will most likely not work. If you know that your DBMS is compatible with one of these listed SQL dialect, you can chose that dialect.</i><br>
	<select name="pdo_slang" id="pdo_slang" onChange="dbplugin_changed()">
	<!-- %SQL_SLANG_SELECTION% -->
	</select></p>
</div>
<script>
plugin_combobox_change_callbacks.push(function(strPlugin) {
	document.getElementById('DBPLUGIN_PARAMS_PDO').style.display = (strPlugin == 'PDO') ? "Block" : "None";
});
rebuild_callbacks.push(function() {
	var e = document.getElementById("db_plugin");
	var strPlugin = e.options[e.selectedIndex].value;
	if (strPlugin != 'PDO') return true;

	document.getElementById('struct_cli_1').innerHTML = '';
	document.getElementById('struct_cli_2').innerHTML = '';
	document.getElementById('struct_1').href = 'struct_empty.sql.php';
	document.getElementById('struct_2').href = 'struct_with_examples.sql.php';

	error = false;

	// Check 1: dsn must not be empty
	if (document.getElementById('pdo_dsn').value.length == 0)
	{
		document.getElementById('pdo_dsn_warn').innerHTML = '<font color="red">Please specify a DSN!</font>';
		document.getElementById('config').innerHTML = '<b>&lt?php</b><br><br><i>// ERROR: Please specify a DSN!</i>';
		error = true;
	} else {
		document.getElementById('pdo_dsn_warn').innerHTML = '';
	}

	// Check 2: Username must not be empty
	if (document.getElementById('pdo_username').value.length == 0)
	{
		document.getElementById('pdo_username_warn').innerHTML = '<font color="red">Please specify a username!</font>';
		document.getElementById('config').innerHTML = '<b>&lt?php</b><br><br><i>// ERROR: Please specify a username!</i>';
		error = true;
	} else {
		document.getElementById('pdo_username_warn').innerHTML = '';
	}

	document.getElementById('struct_1').href = setupdir+'struct_empty.sql.php?plugin=pdo&prefix='+encodeURI(document.getElementById('tablename_prefix').value)+'&slang='+encodeURI(document.getElementById('pdo_slang').value);
	document.getElementById('struct_2').href = setupdir+'struct_with_examples.sql.php?plugin=pdo&prefix='+encodeURI(document.getElementById('tablename_prefix').value)+'&slang='+encodeURI(document.getElementById('pdo_slang').value);
	if (document.getElementById('pdo_slang').value == 'mysql') {
		document.getElementById('struct_cli_1').innerHTML = '<br>or via command line:<br><code>curl -s "'+document.getElementById('struct_1').href+'" | mysql -u '+document.getElementById('pdo_username').value+' -p</code>';
		document.getElementById('struct_cli_2').innerHTML = '<br>or via command line:<br><code>curl -s "'+document.getElementById('struct_2').href+'" | mysql -u '+document.getElementById('pdo_username').value+' -p</code>';
	} else if (document.getElementById('pdo_slang').value == 'pgsql') {
		document.getElementById('struct_cli_1').innerHTML = '<br>or via command line:<br><code>curl -s "'+document.getElementById('struct_1').href+'" | psql -h <font color="red">localhost</font> -U '+document.getElementById('pdo_username').value+' -d <font color="red">oidplus</font> -a</code>';
		document.getElementById('struct_cli_2').innerHTML = '<br>or via command line:<br><code>curl -s "'+document.getElementById('struct_2').href+'" | psql -h <font color="red">localhost</font> -U '+document.getElementById('pdo_username').value+' -d <font color="red">oidplus</font> -a</code>';
	} else {
		document.getElementById('struct_cli_1').innerHTML = '';
		document.getElementById('struct_cli_2').innerHTML = '';
	}

	return !error;
});
rebuild_config_callbacks.push(function() {
	var e = document.getElementById("db_plugin");
	var strPlugin = e.options[e.selectedIndex].value;
	if (strPlugin != 'PDO') return '';

	return 'OIDplus::baseConfig()->setValue(\'PDO_DSN\',           \''+document.getElementById('pdo_dsn').value+'\');<br>' +
	       'OIDplus::baseConfig()->setValue(\'PDO_USERNAME\',      \''+document.getElementById('pdo_username').value+'\');<br>' +
	       'OIDplus::baseConfig()->setValue(\'PDO_PASSWORD\',      base64_decode(\''+b64EncodeUnicode(document.getElementById('pdo_password').value)+'\'));<br>';
});
</script>
