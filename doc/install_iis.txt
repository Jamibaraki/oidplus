
Install OIDplus to Microsoft IIS
================================

(1) Install IIS using "Programs and Features" in the control panel
	( Source: https://docs.microsoft.com/en-us/iis/application-frameworks/scenario-build-a-php-website-on-iis/configuring-step-1-install-iis-and-php )
	
	Install on a Windows Client (Windows 7/8/10 etc.):
		At the command promt, run appwiz.cpl
		Click Turn Windows features on or off.
		In the Windows Features dialog box, click Internet Information Services, note the preselected features that are installed by default, and then select CGI. This selection also installs FastCGI, which is recommended for PHP applications.
		Click OK.
		To verify that IIS installed successfully, type the following into a web browser: http://localhost
		You see the default IIS Welcome page.
		
	Install on a Windows Server:
		Open the Window Server Manager
		In Server Manager, select Dashboard, and click Add roles and features.
		In the Add Roles and Features Wizard, on the Before You Begin page, click Next.
		On the Select Installation Type page, select Role-based or Feature-based Installation and click Next
		On the Select Destination Server page, select Select a server from the server pool, select your server, and click Next.
		On the Select Server Roles page, select Web Server (IIS), and then click Next.
		On the Select Features page, note the preselected features that are installed by default, and then select CGI. This selection also installs FastCGI, which is recommended for PHP applications.
		Click Next.
		On the Web Server Role (IIS) page, click Next.
		On the Select Role Services page, note the preselected role services that are installed by default, and then click Next.
		Note: You only have to install the IIS 8 default role services for a static-content web server.
		On the Confirm Installation Selections page, confirm your selections, and then click Install.
		On the Installation Progress page, confirm that your installation of the Web Server (IIS) role and required role services completed successfully, and then click Close.
		To verify that IIS installed successfully, type the following into a web browser: http://localhost
		You should see the default IIS Welcome page.

(2) Install PHP using the Web Platform Installer
	Go to https://www.microsoft.com/web/downloads/platform.aspx
	Click "Install this extension" to download the setup
	Run WebPlatformInstaller_x64_en-US.msi
	Accept the license aggreement
	In the searchbox at the top right, enter "PHP" and press return
	Select PHP 7.4 or similar
	
	Note: The Web Platform Installer sometimes exits with errors (signature verification failed etc),
	but you can ignore it, as PHP is actually successfully installed!

(3) Place OIDplus here:

	C:\inetpub\wwwroot\oidplus\

(4) Open CMD as administrator and run following command to unlock various things in the web.config file:

	%windir%\system32\inetsrv\appcmd.exe unlock config -section:system.webServer/security/authentication/anonymousAuthentication

(5) Solving problem "SSL Certificate Problem: Unable to get local issuer certificate"
    (e.g. prevents you from registering your system in the admin control panel):

	Download https://curl.haxx.se/ca/cacert.pem and place it in "C:\inetpub\"

	Edit "C:\Program Files (x86)\PHP\v7.4\php.ini" (you need to run Notepad as administrator)
	Search for "curl.cainfo" and change the line into:
	curl.cainfo=C:\inetpub\cacert.pem

	Attention: Placing the file in "C:\Program Files (x86)\PHP\v7.4\extras\ssl\"
	           sometimes causes a lot of problems because PHP has problems with the SysWOW64 replacement.
	           On some systems it works if "(x86)" is simply removed, but on other systems it
	           does not work at all. Instead, weird things happen like "MBstring not found" if
	           you set "curl.cainfo" to a wrong value (a bug in PHP?!)
	           So to be sure, use a different path, e.g. "C:\inetpub\"

	If you want to double-check that everything works, try running
	http://localhost/oidplus/dev/curl_https_check.php
	(You need to move the file out of the "dev" directory, because it is secured from being accessed)
	
(6) Configure OpenSSL

	Create the directory
	C:\Program Files (x86)\Common Files\SSL
	
	Copy the file
	C:\Program Files (x86)\PHP\v7.4\extras\ssl\openssl.cnf
	into the directory
	C:\Program Files (x86)\Common Files\SSL
	
	To see in which path PHP searches the openssl.cnf file, open
	http://localhost/oidplus/dev/info.php
	and look for the string "Openssl default config".
	(You need to move the file out of the "dev" directory, because it is secured from being accessed)
	
	If you want to double-check that everything works, try running
	http://localhost/oidplus/dev/check_openssl_keygen.php
	(You need to move the file out of the "dev" directory, because it is secured from being accessed)

(7) Open http://localhost/oidplus and follow the setup instructions
